<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8">
  <title>Kymppikaide – Konfiguraattori</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:900px; margin:20px auto;}
    .row, .row2 {margin-bottom:15px;}
    .row2 {margin-top:7px;}
    .config-section, .draw-section {background:#f6f6f6; border:1px solid #e0e0e0; border-radius:7px; padding:15px; margin-bottom:15px;}
    .msg {color:green; font-weight:bold;}
    .toolbar {margin-bottom: 10px;}
    .toolbar button {margin-right:6px; font-size:1em; padding:6px 12px; border-radius:4px;}
    .toolbar .active {background:#e0eafc;}
    canvas {border: 1px solid #888; background:#fff;}
    .file-label{margin-right:12px;}
    .info{font-size:0.97em; margin-bottom:14px;}
  </style>
</head>
<body>
  <h2>Kymppikaide – konfiguraattori</h2>
  <!-- Piirtoalusta pohjavalinnoilla -->
  <div class="draw-section">
    <b>Piirrettävän pohjan tyyppi:</b>
    <select id="pohjaValinta">
      <option value="terassi">Terassi</option>
      <option value="porras">Porras</option>
    </select>
    <span id="terassiOptions">
      Leveys: <input type="number" id="terassiLeveys" value="3.0" step="0.01" min="1.0" max="10.0" style="width:60px;"> m
      Pituus: <input type="number" id="terassiPituus" value="5.5" step="0.01" min="1.0" max="20.0" style="width:60px;"> m
    </span>
    <span id="porrasOptions" style="display:none">
      Nousu: <input type="number" id="porrasNousu" value="180" step="1" min="80" max="250" style="width:50px;"> mm
      Etenemä: <input type="number" id="porrasEtenema" value="260" step="1" min="150" max="350" style="width:50px;"> mm
      Askelmien määrä: <input type="number" id="porrasAskelma" value="7" step="1" min="2" max="30" style="width:45px;">
    </span>
    <div class="toolbar">
      <button id="drawRailing" class="active">Piirrä kaidetta</button>
      <button id="drawHandrail">Piirrä käsijohdetta</button>
      <button id="finishDraw">Lopeta piirto</button>
      <button id="cutLine">Leikkaa (sakset)</button>
      <button id="undoDraw">Undo viimeisin</button>
    </div>
    <canvas id="canvas" width="820" height="400"></canvas>
  </div>

  <div class="row2 info">
    <b>Voit liittää PDF- ja kuvatiedostoja tarjouspyyntöön.</b>
    <input type="file" id="attachments" multiple>
    <span id="fileList"></span>
  </div>

  <form id="quotationForm">
    <h3>Yhteystiedot</h3>
    <div class="row"><input name="nimi" required placeholder="Nimi" style="width:98%"></div>
    <div class="row"><input name="osoite" required placeholder="Osoite" style="width:98%"></div>
    <div class="row"><input name="puhelin" required placeholder="Puhelinnumero" style="width:98%"></div>
    <div class="row"><input name="email" type="email" required placeholder="Sähköposti" style="width:98%"></div>
    <h4>Kaidevalinnat</h4>
    <div class="row">
      <b>Kiinnitysmateriaali:</b>
      <select id="material">
        <option value="betoni">Betoni</option>
        <option value="puu">Puu</option>
        <option value="muu">Muu</option>
      </select>
      <input id="customMaterial" type="text" placeholder="Muu" style="display:none;width:120px;">
    </div>
    <div class="row">
      <b>Kaiteen väri:</b>
      <select id="color">
        <option value="RAL9005">Musta (RAL9005)</option>
        <option value="RAL9010">Valkoinen (RAL9010)</option>
        <option value="RAL7024">Tumman harmaa (RAL7024)</option>
        <option value="RAL7040">Vaalean harmaa (RAL7040)</option>
      </select>
    </div>
    <div class="row">
      <b>Kaiteen malli:</b>
      <select id="kaidetyyppi">
        <option value="pinnakaide">Pinnakaide</option>
        <option value="lattakaide">Lattakaide</option>
      </select>
    </div>
    <h4>Käsijohdevalinnat</h4>
    <div class="row">
      <b>Käsijohteen materiaali:</b>
      <select id="handrailMat">
        <option value="mustateräs">Mustateräs</option>
        <option value="harjattu_rst">Harjattu RST</option>
      </select>
      <span>
        Tuleeko käsijohde ulos?
        <select id="handrailOutdoor">
          <option value="ei">Ei</option>
          <option value="kyllä">Kyllä</option>
        </select>
      </span>
    </div>
    <div class="row">
      <b>Käsijohteen väri:</b>
      <select id="handrailColor">
        <option value="RAL9005">Musta (RAL9005)</option>
        <option value="RAL9010">Valkoinen (RAL9010)</option>
        <option value="RAL7024">Tumman harmaa (RAL7024)</option>
        <option value="RAL7040">Vaalean harmaa (RAL7040)</option>
      </select>
    </div>
    <div class="row"><button type="submit" style="font-size:1.05em;">Lähetä tarjouspyyntö</button>
    <span id="msg" class="msg"></span>
    </div>
  </form>

  <script>
    // Pohjan valinta logiikka
    document.getElementById('pohjaValinta').onchange = function() {
      let tyyppi = this.value;
      document.getElementById('terassiOptions').style.display = tyyppi === 'terassi' ? 'inline' : 'none';
      document.getElementById('porrasOptions').style.display = tyyppi === 'porras' ? 'inline' : 'none';
    };

    // Canvas-koodissa: tilan vaihto napista
    let mode = 'railing', drawing=false;
    let railing = [], handrail = [];
    let undoStack = [];

    function setMode(m) {
      mode = m;
      document.getElementById('drawRailing').classList.toggle('active', m=='railing');
      document.getElementById('drawHandrail').classList.toggle('active', m=='handrail');
    }
    document.getElementById('drawRailing').onclick = ()=>setMode('railing');
    document.getElementById('drawHandrail').onclick = ()=>setMode('handrail');
    document.getElementById('finishDraw').onclick = ()=>drawing=false;

    document.getElementById('undoDraw').onclick = function() {
      if(mode=='railing' && railing.length>0) { undoStack.push(railing.pop()); }
      if(mode=='handrail' && handrail.length>0) { undoStack.push(handrail.pop()); }
      draw();
    };

    document.getElementById('cutLine').onclick = function(){
      if(mode=='railing' && railing.length>0) { railing.pop(); }
      if(mode=='handrail' && handrail.length>0) { handrail.pop(); }
      draw();
    };

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    canvas.onmousedown = function(e){
      let pt = {x: e.offsetX, y: e.offsetY};
      drawing = true;
      if(mode=='railing') railing.push(pt);
      else handrail.push(pt);
      draw();
    };

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // pohja: terassi/porras
      let tyyppi = document.getElementById('pohjaValinta').value;
      if(tyyppi=='terassi'){
        let w=parseFloat(document.getElementById('terassiLeveys').value), h=parseFloat(document.getElementById('terassiPituus').value);
        ctx.strokeStyle="#d3c551"; ctx.lineWidth=2; ctx.strokeRect(60,60,w*70,h*30); // skaalataan demoarvoilla
      } else if(tyyppi=='porras') {
        let nousu=parseInt(document.getElementById('porrasNousu').value), ete=parseInt(document.getElementById('porrasEtenema').value), n=parseInt(document.getElementById('porrasAskelma').value);
        ctx.strokeStyle="#c7914d"; ctx.lineWidth=2;
        let x=60, y=320;
        for(let i=0; i<n; i++){
          ctx.beginPath();
          ctx.moveTo(x,y);
          y -= nousu/2; x += ete/2; // Demo skaalaus!
          ctx.lineTo(x,y);
          ctx.stroke();
        }
      }
      // Kaidepiirto
      ctx.strokeStyle="blue"; ctx.lineWidth=4;
      ctx.beginPath();
      railing.forEach((pt,i)=>i==0?ctx.moveTo(pt.x,pt.y):ctx.lineTo(pt.x,pt.y));
      ctx.stroke();
      // Käsijohde
      ctx.strokeStyle="red"; ctx.lineWidth=2;
      ctx.beginPath();
      handrail.forEach((pt,i)=>i==0?ctx.moveTo(pt.x,pt.y):ctx.lineTo(pt.x,pt.y));
      ctx.stroke();
    }
    // automaattinen redraw
    ['terassiLeveys','terassiPituus','porrasNousu','porrasEtenema','porrasAskelma','pohjaValinta'].forEach(id=>{
      document.getElementById(id).oninput = draw;
    });
    draw();

    // Materiaalilogiiikka (käsijohde ulos = rst)
    document.getElementById('handrailOutdoor').onchange=function(){
      if(this.value=="kyllä"){
        document.getElementById('handrailMat').value="harjattu_rst";
        document.getElementById('handrailMat').disabled = true;
      }else{
        document.getElementById('handrailMat').disabled = false;
      }
    };

    // Liitetiedostot
    document.getElementById('attachments').addEventListener('change',function(e){
      const files=[...e.target.files];
      let ul = files.map(f=>`<span class="file-label">${f.name}</span>`).join("");
      document.getElementById('fileList').innerHTML = ul;
    });

    document.getElementById('material').onchange = function(e){
      document.getElementById('customMaterial').style.display=(e.target.value=='muu')?'inline-block':'none';
    };

    // Lomakkeen lähetys (demo)
    document.getElementById('quotationForm').onsubmit = function(e){
      e.preventDefault();
      // ...tallennuslogiikka tänne...
      document.getElementById('msg').textContent = "Kiitos tarjouspyynnöstä! (Demo)";
      setTimeout(()=>document.getElementById('msg').textContent="",4000);
    };
  </script>
</body>
</html>
